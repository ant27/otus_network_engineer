### Занятие 2. Конспект.

Дата занятия: 05.03.21

#### Обзор сетей VLAN.

##### Определение сети VLAN.

VLAN является технологией совмещения в одном физическом устройстве нескольких логических локальных сетей так, как будто они являются физически разными.

Назначение VLAN:
- Обеспечение сегментации различных групп устройств на одних и тех же коммутаторах.
- Изоляция широковещательных и многоадресных передач в отдельной VLAN.
- Повышение уровня безопасности.
- Разделение типа траффика с разным приоритетом (административный, голосовой)
- Снижение затрат.

##### Типы сетей VLAN.

VLAN 1 является сетью по умолчанию. Ее невозможно удалить или переименовать. Таакже она является сетью по умолчанию для нетегированного трафиика.

Основные типы VLAN:

- VLAN для данных
- Голосовой VLAN
- VLAN управления (Management) 

##### Сети без VLAN и с VLAN.

В сетях без VLAN весь unicast и broadcast траффик получают все устройства, подключенные к коммутаторам.

В сетях с VLAN unicast и broadcast траффик ограничен VLAN, и без устройства уровня L3 хосты в разных VLAN не могут обмениваться данными.

##### Тегирование кадров Ethernet для идентификации сети VLAN.

Последовательность:

При приеме кадра от конечного устройства ему в соответствии со спецификацией IEEE 802.1Q добавляется 4х-байтовый заголовок VLAN, состоящий из:
- 2х-битового поля типа протокола тегов со значением 0x8100 (тип тега VLAN)
- 3х-битовое поле приоритета QoS
- 1х-битовое поле идентификатора канонического формата
- 12-битное поле идентификатора VLAN (4096 VLAN) 

Если в магистральный (trunk) канал попадает нетегированный траффик, он направляется в нативный VLAN (обычно VLAN1). 

Дополнительно изучить: для каких целей используется передача нетегированного траффика

Разделение VLAN:
- Данные о VLAN с 1 по 1005 хранятся в файле vlan.dat на flash-памяти.
- VLAN 1002 - 1005 зарезервированы для старых VLAN, создаются автоматически и не могут быть удалены.
- Данные о VLAN с 1006 - 4096 хранятся в конфигурации running-config.

Примечание: Протокол VTP (протокол обмена данными о VLAN между сетевыми устройствами) может быть опасен перезаписьмю неактуальных данных о VLAN с необновленного сетевого устройства.

##### Команды создания VLAN.

`S1#configure terminal`

`S1(config)#vlan vlan-id`

`S1(config)#name vlan-name`

`S1(config)#end`

##### Команды назначения портов VLAN.

`S1#configure terminal`

- Вход в режим конфигурирования интерфейса

`S1(config)#interface interface-id`

- Или вход в режим конфигурирования нескольких интерфейсов

`S1(config)#interface range interface-id-range`

- Перевод порта в access mode

`S1(config)#switchport mode access`

- Назначение порта сети VLAN

`S1(config)#switchport access vlan vlan-id`

`S1(config)#end`

Примечание: access порт можно включить только в один VLAN, за исключением VLAN, назначенным голосовым. Назначение порту голосового VLAN делается командой **switchport voice vlan vlan-id**

Проверка созданных VLAN:

`S1(config)#show vlan`

##### Команда назначения портов в trunk.

`S1#configure terminal`

- Вход в режим конфигурирования интерфейса

`S1(config)#interface interface-id`

- Или вход в режим конфигурирования нескольких интерфейсов

`S1(config)#interface range interface-id-range`

- Перевод порта в trunk mode

`S1(config)#switchport mode trunk`

- Назначение VLAN нативным

`S1(config)#switchport trunk native vlan vlan-id`

- Назначение разрешенных для порта VLAN

`S1(config)#switchport trunk allowed vlan vlan-list`

`S1(config)#end`

##### Сброс назначения портов в trunk.

`S1#configure terminal`

`S1(config)#interface interface-id`

`S1(config)#no switchport mode trunk allowed vlan`

`S1(config)#no switchport mode trunk native vlan`

- Второй вариант - перевод порта в access mode:

`S1#configure terminal`

`S1(config)#interface interface-id`

`S1(config)#switchport mode access`

`S1(config)#end`

##### DTP - протокол динамического транкинга.

Протокол предназначен для автоматического перевода портов коммутатора в транковый режим, если на другой стороне линии порт другого сетевого устройства перешел в такой режим.
По умолчанию этот протокол включен на портах устройств CISCO. Может быть выключен следующей командой: 

`S1(config)#switchport nonegotiate`

Обратно включить протокол DTP на порту можно командой:

`S1(config)#switchport mode dynamic auto`

##### Маршрутизация между VLAN.

Существует 3 варианта маршрутизации между VLAN:

###### Старый метод маршрутизации между VLAN - метод, когда не делается транковых портов, а выделяем на маршрутизаторе столько портов, чтобы он имел по порту в каждом VLAN.
###### Router-On-A-Stick - маршрутизатор на палке 
###### Коммутатор уровня 3 с использованием коммутируемых виртуальных интерфейсов (SVI)

